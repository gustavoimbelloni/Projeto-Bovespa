graph TB
    %% Defini√ß√£o de estilos
    classDef awsService fill:#FF9900,stroke:#232F3E,stroke-width:2px,color:#FFFFFF
    classDef dataStore fill:#3F48CC,stroke:#232F3E,stroke-width:2px,color:#FFFFFF
    classDef process fill:#146EB4,stroke:#232F3E,stroke-width:2px,color:#FFFFFF
    classDef external fill:#232F3E,stroke:#FF9900,stroke-width:2px,color:#FFFFFF
    
    %% Componentes externos
    B3[üåê Site B3<br/>sistemaswebb3-listados.b3.com.br<br/>Dados do IBovespa]:::external
    
    %% Camada de Ingest√£o
    SCRAPER[üìä Script Python<br/>b3_scraper.py<br/>‚Ä¢ BeautifulSoup4<br/>‚Ä¢ Requests<br/>‚Ä¢ Pandas]:::process
    
    %% Armazenamento Raw
    S3_RAW[(üóÑÔ∏è Amazon S3<br/>Raw Data Bucket<br/>Formato: Parquet<br/>Parti√ß√£o: year/month/day)]:::dataStore
    
    %% Orquestra√ß√£o
    LAMBDA[‚ö° AWS Lambda<br/>trigger-glue-job<br/>‚Ä¢ Python 3.11<br/>‚Ä¢ Boto3<br/>‚Ä¢ Event-driven]:::awsService
    
    %% Processamento ETL
    GLUE[üîÑ AWS Glue<br/>bovespa-etl-job<br/>‚Ä¢ Modo Visual<br/>‚Ä¢ Spark 3.3<br/>‚Ä¢ Python 3.9]:::awsService
    
    %% Armazenamento Refined
    S3_REFINED[(üóÑÔ∏è Amazon S3<br/>Refined Data Bucket<br/>Formato: Parquet<br/>Parti√ß√£o: year/month/day/tipo)]:::dataStore
    
    %% Cataloga√ß√£o
    CATALOG[(üìö AWS Glue<br/>Data Catalog<br/>Database: default<br/>Table: bovespa_refined_data)]:::awsService
    
    %% Consulta
    ATHENA[üîç Amazon Athena<br/>Query Engine<br/>‚Ä¢ SQL Interface<br/>‚Ä¢ Serverless]:::awsService
    
    %% Monitoramento
    CLOUDWATCH[üìä CloudWatch<br/>Logs & Metrics<br/>‚Ä¢ Lambda logs<br/>‚Ä¢ Glue job logs<br/>‚Ä¢ Alertas]:::awsService
    
    %% Fluxo de dados
    B3 -->|HTTP GET<br/>Daily Scraping| SCRAPER
    SCRAPER -->|Upload Parquet<br/>Partitioned by Date| S3_RAW
    S3_RAW -->|S3 Event<br/>ObjectCreated| LAMBDA
    LAMBDA -->|StartJobRun<br/>Boto3 API| GLUE
    
    %% Transforma√ß√µes do Glue
    GLUE -->|ETL Process| TRANSFORM[üîß Transforma√ß√µes<br/>A: Agrupamento por tipo<br/>B: Renomear colunas<br/>C: C√°lculo de datas]:::process
    TRANSFORM -->|Save Parquet<br/>Partitioned| S3_REFINED
    
    %% Cataloga√ß√£o autom√°tica
    GLUE -->|Auto Catalog<br/>Update Schema| CATALOG
    S3_REFINED -.->|Metadata| CATALOG
    
    %% Consultas
    CATALOG -->|Table Schema| ATHENA
    S3_REFINED -->|Query Data| ATHENA
    
    %% Monitoramento
    SCRAPER -.->|Logs| CLOUDWATCH
    LAMBDA -.->|Execution Logs| CLOUDWATCH
    GLUE -.->|Job Logs| CLOUDWATCH
    
    %% Agendamento (opcional)
    EVENTBRIDGE[‚è∞ EventBridge<br/>Daily Schedule<br/>cron 0 18 * * ? *]:::awsService
    EVENTBRIDGE -.->|Trigger Daily| SCRAPER
    
    %% Subgr√°ficos para organiza√ß√£o
    subgraph "Camada de Ingest√£o"
        B3
        SCRAPER
    end
    
    subgraph "Camada de Armazenamento Raw"
        S3_RAW
    end
    
    subgraph "Camada de Processamento"
        LAMBDA
        GLUE
        TRANSFORM
    end
    
    subgraph "Camada de Armazenamento Refined"
        S3_REFINED
        CATALOG
    end
    
    subgraph "Camada de Consulta"
        ATHENA
    end
    
    subgraph "Camada de Monitoramento"
        CLOUDWATCH
        EVENTBRIDGE
    end

